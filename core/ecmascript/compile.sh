#!/bin/sh
cat > tsconfig.json << EOF
{
    "*Generated by compile.sh*":"Generated by compile.sh",
    "compilerOptions": {
        "types": ["$HOME/.config/yarn/global/node_modules/@types/node/"],
        "allowJs": true,
    },
    "files": [
        "lang.ts"
    ]
}
EOF

tsc --build tsconfig.json || exit
js="$(cat lang.js)"
cat > lang.full.js << EOF
// Generated by compile.sh
$js
EOF

echo '// Generated by compile.sh' > lang.externs.js
echo 'var exports = {};' >> lang.externs.js
grep 'exports.' lang.full.js | awk '{print $1}' | sed "s/^\(.*\)$/\1 = 'something';/" >> lang.externs.js
google-closure-compiler -W QUIET --language_out ECMASCRIPT3 --js lang.full.js --externs lang.externs.js -O ADVANCED > lang.js
