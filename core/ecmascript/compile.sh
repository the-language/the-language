#!/bin/sh
tsc --build tsconfig.json || exit
js="$(cat lang.js)"
cat > lang.js << EOF
// Generated by compile.sh
$js
EOF

echo '// Generated by compile.sh' > lang.min.externs.js
echo 'var exports = {};' >> lang.min.externs.js
grep 'exports.' lang.js | awk '{print $1}' | sed "s/^\(.*\)$/\1 = 'something';/" >> lang.min.externs.js
google-closure-compiler -W QUIET --language_out ECMASCRIPT3 --js lang.js --externs lang.min.externs.js -O ADVANCED > lang.min.js

mv lang.min.js lang.js
