#!/bin/sh
tsc --build tsconfig.json || exit
js="$(cat lang.js)"
cat > lang.js << EOF
// Generated by compile.sh
$js
EOF
mv lang.js lang.full.js

echo '// Generated by compile.sh' > lang.externs.js
echo 'var exports = {};' >> lang.externs.js
grep 'exports.' lang.full.js | awk '{print $1}' | sed "s/^\(.*\)$/\1 = 'something';/" >> lang.externs.js
google-closure-compiler -W QUIET --language_out ECMASCRIPT3 --js lang.full.js --externs lang.externs.js -O ADVANCED > lang.js

